<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script>

        var url = "http://localhost:3000/links";

        // function click(option){
        //     $.get("http://localhost:3000/click/" + option);
        // }

        //reset game
        // function reset(){
        //     $.get("http://localhost:3000/reset");
        // }

        //Recursion with delay
        // var turns = 0;
        // function play() {
        //     $.getJSON(url, function (data) {
        //         var numLinks = data.links.length;
        //         // console.log(data.links);
        //         if (numLinks === 0 || turns === 10) {
        //             // console.log(turns);
        //         } else {
        //             var ranOp = Math.round(Math.random() * (numLinks - 1));
        //             // console.log(ranOp);
        //             click(ranOp);
        //             setTimeout(function () {
        //                 turns++;
        //                 play();
        //             }, 100);
        //         }
        //     })
        // }

        //Recursion - continuously getJSON till it changes
        // once change - count turns and click
        var turns = 0;
        var numPlays = [];
        function play(pre) {
            $.getJSON(url, function (data) {
                var links = data.links;
                var numLinks = data.links.length;

                //end of game
                if (numLinks === 0) {
                    numPlays.push(turns);
                    // console.log(numPlays);
                    turns = 0;
                }
                //same as previous, skip
                else if(links[0].text === pre){
                    play(links[0].text);
                }
                //next stage of game, choose option, move on
                else {
                    //generate random number with number of options
                    var ranOp = Math.round(Math.random() * (numLinks - 1));
                    //click random option
                    $.get("http://localhost:3000/click/" + ranOp, function () {
                        turns++;
                        play(links[0].text);
                    })
                }
            })
        }

        //multiply play through with delay on reset and play
        // for(let i = 0; i < 20; i++){
        //     setTimeout(function(){
        //         reset();
        //     }, 2000*i);
        //     setTimeout(function(){
        //         play("  ");
        //     }, 2000*i+1000);
        // }

        var numGames = 20;
        var millsec = 2000;

        //multiply play through with delay on a game play
        function checkReset(){
            $.getJSON(url, function(data){
                //not finished resetting
                if(data.links.length === 0){
                    checkReset();
                }
                //reset finished, play twine
                else{
                    play("");
                }
            })
        }
        for(let i = 0; i < numGames; i++){
            setTimeout(function(){
                //reset twine game
                $.get("http://localhost:3000/reset", function(){
                    checkReset();
                });
            }, millsec*i);
        }

        //calculate average
        setTimeout(function(){
            var sum = numPlays.reduce(getSum);
            var average = sum / numPlays.length;

            console.log(sum);
            console.log(average);

        }, millsec*numGames);
        function getSum(total, num){
            return total + num;
        }



    </script>
</body>
</html>